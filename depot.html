<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dépôt Mobile Money</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#eef2f7; padding-top:40px; }
    .card { border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.07); }
    label.required:after { content:" *"; color:#d00; }
    a{
    background-color: #e01b1b;
    color: white;
    padding: 10px;
    text-decoration: none;
    border-radius: 15px;
    font-size: 20px;

}
a:hover{
    text-decoration: underline;
}
  </style>
</head>

<body>
  <Center>
  <a href="depot.html">Effectuer un depot</a>
    <a href="indext.html">Accueil</a>
    <br>
    <br>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-7">
      <div class="card p-4">
        <h4 class="mb-3">Effectuer un dépôt Mobile Money</h4>

        <form id="depositForm" novalidate>

          <div class="mb-3">
            <label class="form-label required">Ton numéro (expéditeur)</label>
            <input type="tel" id="sender" name="sender" class="form-control"
                   placeholder="ex: 22991234567" required>
            <div class="invalid-feedback">Entre ton numéro valide.</div>
          </div>

          <div class="mb-3">
            <label class="form-label required">Choisir le destinataire</label>
            <select id="recipient" name="recipient" class="form-select" required>
              <option value="">-- Sélectionner --</option>
              <option value="0195810161">Moov Money (0195810161)</option>
              <option value="0149981609">Celtis (0149981609)</option>
            </select>
            <div class="invalid-feedback">Choisis un destinataire.</div>
          </div>

          <div class="mb-3">
            <label class="form-label required">Montant</label>
            <input type="number" id="amount" name="amount" class="form-control"
                   min="50" step="0.01" placeholder="Ex : 2000" required>
            <div class="invalid-feedback">Montant invalide.</div>
          </div>

          <div class="mb-3">
            <label class="form-label">Motif (optionnel)</label>
            <input type="text" id="note" name="note" class="form-control"
                   placeholder="Ex : achat miel">
          </div>

          <div class="d-grid">
            <button type="submit" id="sendBtn" class="btn btn-primary">
              Envoyer le dépôt
            </button>
          </div>

        </form>

        <div id="result" class="mt-3"></div>

      </div>
    </div>
  </div>
</div>
<h3>Une fois Effectuer le dépôt clic en bas sur Wthasap  pour me confirmé <br><br><a href="https://wa.me/2290195810161?text=Bonjour%2C%20je%20suis%20int%C3%A9ress%C3%A9(e)%20par%20vos%20services">Wthasap</a></h3>

</Center>
<script>
  
document.getElementById("depositForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const form = e.target;
  if (!form.checkValidity()) {
    form.classList.add("was-validated");
    return;
  }

  const payload = {
    sender: document.getElementById("sender").value.trim(),
    recipient: document.getElementById("recipient").value.trim(),
    amount: document.getElementById("amount").value.trim(),
    note: document.getElementById("note").value.trim()
  };

  const btn = document.getElementById("sendBtn");
  btn.disabled = true;
  btn.textContent = "Traitement...";

  try {
    const resp = await fetch("process_depot.php", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });

    const data = await resp.json();

    if (data.status === "success") {
      document.getElementById("result").innerHTML =
        `<div class="alert alert-success">
           Dépôt enregistré avec succès !<br>
           <strong>ID :</strong> ${data.tx_id} <br>
           <strong>Montant :</strong> ${data.amount} <br>
           <strong>Destinataire :</strong> ${payload.recipient}
         </div>`;
      form.reset();
      form.classList.remove("was-validated");
    } else {
      document.getElementById("result").innerHTML =
        `<div class="alert alert-danger">Erreur : ${data.message}</div>`;
    }

  } catch (err) {
    document.getElementById("result").innerHTML =
      `<div class="alert alert-danger">Erreur serveur.</div>`;
  }

  btn.disabled = false;
  btn.textContent = "Envoyer le dépôt";
});

</script>
</body>
</html>


